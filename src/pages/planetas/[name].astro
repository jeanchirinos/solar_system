---
import Layout from '@/layouts/Layout.astro'
import { CurrentPlanetWrapper } from '@/components/CurrentPlanetWrapper'
import type { PlanetsInfo } from '@/types/Planet'
import type { TransitionAnimationPair } from 'astro'
import CurrentPlanet from '@/components/CurrentPlanet.astro'

export async function getStaticPaths() {
  const response = await fetch('https://api-sistemasolar.nijui.com/api/planets')

  const { planets } = (await response.json()) as PlanetsInfo

  function getPrevPlanet(index: number) {
    if (index === 0) return null
    return planets[index - 1]
  }

  function getNextPlanet(index: number) {
    if (index === planets.length - 1) return null
    return planets[index + 1]
  }

  const data = planets.map((planet, i) => {
    return {
      params: {
        name: planet.name.toLowerCase(),
      },
      props: {
        planet,
        prevPlanet: getPrevPlanet(i),
        nextPlanet: getNextPlanet(i),
      },
    }
  })

  return data
}

const animationForwards: TransitionAnimationPair = {
  old: {
    name: 'astroSlideToLeft,astroFadeOut',
    duration: '0.3s',
    fillMode: 'both,both',
  },
  new: {
    name: 'astroSlideFromRight,astroFadeIn',
    duration: '0.3s',
    fillMode: 'both,both',
  },
}

const animationBackwards: TransitionAnimationPair = {
  old: {
    name: 'astroSlideToRight,astroFadeOut',
    duration: '0.3s',
    fillMode: 'both,both',
  },
  new: {
    name: 'astroSlideFromLeft,astroFadeIn',
    duration: '0.3s',
    fillMode: 'both,both',
  },
}

const customSlideViewTransitionPrev = {
  forwards: animationBackwards,
  backwards: animationForwards,
}

const customSlideViewTransitionNext = {
  forwards: animationForwards,
  backwards: animationBackwards,
}

const { planet, prevPlanet, nextPlanet } = Astro.props
---

<Layout title={planet.name} description={planet.description} image={planet.png!}>
  <div
    class='mx-auto grid h-dvh max-h-[1000px] min-h-[500px] max-w-[1600px] grid-cols-1 grid-rows-[auto_minmax(0,1fr)_auto] gap-y-12 px-4 py-2'
  >
    <h1 class='text-center text-4xl font-black uppercase sm:text-6xl'>{planet.name}</h1>

    <CurrentPlanetWrapper client:load {prevPlanet} {nextPlanet}>
      <CurrentPlanet
        slot='prev'
        {planet}
        transition:name='planeta_prev'
        transition:animate={customSlideViewTransitionPrev}
      />

      <CurrentPlanet
        slot='next'
        {planet}
        transition:name='planeta_next'
        transition:animate={customSlideViewTransitionNext}
      />
    </CurrentPlanetWrapper>
  </div>
</Layout>
